(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[438],{4188:function(e,t,s){Promise.resolve().then(s.bind(s,6824))},6824:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return r}});var a=s(5959),n=s(7495);function r(){let[e,t]=(0,n.useState)(""),[s,r]=(0,n.useState)([]),[i,l]=(0,n.useState)(null),[c,d]=(0,n.useState)("idle"),[o,h]=(0,n.useState)(null),[u,m]=(0,n.useState)("");async function x(e,t){d("loading"),h(null);try{var s;let a=new URL("/api/admin/registrations",window.location.origin);t&&a.searchParams.set("q",t);let n=await fetch(a.toString(),{headers:{"x-admin-secret":e}}),i=await n.json();if(!n.ok)throw Error(null!==(s=i.error)&&void 0!==s?s:"Failed to load registrations");r(i.registrations),l(i.conference),d("idle")}catch(e){d("error"),h(e.message)}}async function j(t){t.preventDefault(),window.localStorage.setItem("shfmk_admin_secret",e),await x(e,u)}async function g(){let t=new URL("/api/admin/registrations",window.location.origin);t.searchParams.set("format","csv"),u&&t.searchParams.set("q",u);let s=await fetch(t.toString(),{headers:{"x-admin-secret":e}}),a=await s.text();if(!s.ok){h(a);return}let n=new Blob([a],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="registrations.csv",r.click()}async function f(t){let s=await fetch("/api/admin/resend",{method:"POST",headers:{"Content-Type":"application/json","x-admin-secret":e},body:JSON.stringify({registrationId:t})});if(!s.ok){var a;alert(null!==(a=(await s.json()).error)&&void 0!==a?a:"Failed to resend");return}alert("Resent!")}(0,n.useEffect)(()=>{let e=window.localStorage.getItem("shfmk_admin_secret");e&&(t(e),x(e,""))},[]);let p=(0,n.useMemo)(()=>s.reduce((e,t)=>e+Number(t.fee_amount),0),[s]);return e?(0,a.jsxs)("div",{className:"grid",style:{gap:16},children:[(0,a.jsxs)("header",{className:"grid",style:{gap:6},children:[(0,a.jsx)("span",{className:"pill",children:"Admin"}),(0,a.jsx)("h1",{style:{margin:0},children:"Registrations"}),i&&(0,a.jsx)("p",{style:{margin:0,color:"#cbd5e1"},children:i.name})]}),(0,a.jsxs)("div",{className:"card grid",style:{gap:12},children:[(0,a.jsxs)("div",{className:"actions",style:{justifyContent:"space-between"},children:[(0,a.jsx)("input",{className:"input",style:{flex:1},placeholder:"Search name or email",value:u,onChange:t=>{m(t.target.value),x(e,t.target.value)}}),(0,a.jsx)("button",{className:"btn secondary",type:"button",onClick:g,children:"Export CSV"})]}),"loading"===c&&(0,a.jsx)("div",{children:"Loading..."}),o&&(0,a.jsx)("div",{style:{color:"#fca5a5"},children:o}),(0,a.jsx)("div",{style:{overflowX:"auto"},children:(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Category"}),(0,a.jsx)("th",{children:"Fee"}),(0,a.jsx)("th",{children:"Registered"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.full_name}),(0,a.jsx)("td",{children:e.email}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"badge",children:e.category})}),(0,a.jsxs)("td",{children:[e.fee_amount," ",e.currency]}),(0,a.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{className:"btn secondary",type:"button",onClick:()=>f(e.id),children:"Resend email"})})]},e.id))})]})}),(0,a.jsxs)("div",{style:{color:"#cbd5e1"},children:["Total registrations: ",(0,a.jsx)("strong",{children:s.length})," | Fees:"," ",(0,a.jsx)("strong",{children:p.toFixed(2)})]})]})]}):(0,a.jsxs)("div",{className:"card",style:{maxWidth:480,margin:"0 auto"},children:[(0,a.jsx)("h1",{style:{marginTop:0},children:"Admin access"}),(0,a.jsxs)("form",{onSubmit:j,className:"grid",style:{gap:12},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",htmlFor:"secret",children:"Shared secret"}),(0,a.jsx)("input",{id:"secret",className:"input",value:e,onChange:e=>t(e.target.value),placeholder:"Enter ADMIN_SECRET"})]}),(0,a.jsx)("button",{className:"btn",type:"submit",children:"Unlock"})]})]})}}},function(e){e.O(0,[777,474,744],function(){return e(e.s=4188)}),_N_E=e.O()}]);