"use strict";(()=>{var e={};e.id=710,e.ids=[710],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6925:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var n={};r.r(n),r.d(n,{GET:()=>d});var o=r(2556),i=r(6546),a=r(4042),s=r(3675),c=r(2605),l=r(9147),u=r(4137);async function d(e){let t=e.headers.get("x-admin-secret");try{(0,c.E)(t)}catch(e){return s.NextResponse.json({error:"Unauthorized"},{status:401})}let r=new URL(e.url),n=r.searchParams.get("q")??void 0,o=r.searchParams.get("conf")??l.Q0,i=r.searchParams.get("format")??"json",a=await (0,u.o3)(o);if(!a)return s.NextResponse.json({error:"Conference not found"},{status:404});let d=await (0,u.LA)({conferenceId:a.id,search:n});if("csv"===i){let e=function(e){if(0===e.length)return"";let t=Object.keys(e[0]),r=e=>{if(null==e)return"";let t=String(e);return t.includes(",")||t.includes("\n")||t.includes('"')?`"${t.replace(/"/g,'""')}"`:t};return[t.join(","),...e.map(e=>t.map(t=>r(e[t])).join(","))].join("\n")}(d);return new s.NextResponse(e,{status:200,headers:{"Content-Type":"text/csv","Content-Disposition":'attachment; filename="registrations.csv"'}})}return s.NextResponse.json({registrations:d,conference:a})}let f=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/registrations/route",pathname:"/api/admin/registrations",filename:"route",bundlePath:"app/api/admin/registrations/route"},resolvedPagePath:"/Users/arbenlila/development/shfmk-association/apps/web/app/api/admin/registrations/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:g}=f,E="/api/admin/registrations/route";function h(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},2605:(e,t,r)=>{r.d(t,{E:()=>o});var n=r(9147);function o(e){if(!n.wb)throw Error("ADMIN_SECRET is not configured.");if(!e||e!==n.wb)throw Error("Unauthorized")}},9147:(e,t,r)=>{r.d(t,{Bt:()=>u,Nn:()=>i,Q0:()=>n,ZE:()=>s,mF:()=>o,wb:()=>l,yL:()=>a,zV:()=>c});let n=process.env.CONFERENCE_SLUG??"annual-conference",o=process.env.SUPABASE_URL??"",i=process.env.SUPABASE_SERVICE_KEY??"",a=process.env.RESEND_API_KEY??"",s=process.env.RESEND_FROM_EMAIL??"",c=process.env.QR_PRIVATE_KEY_PEM,l=process.env.ADMIN_SECRET??"",u=process.env.SITE_BASE_URL??"http://localhost:3000"},4137:(e,t,r)=>{r.d(t,{JQ:()=>d,LA:()=>f,Xd:()=>m,_Y:()=>u,nb:()=>l,o3:()=>s,pb:()=>c});var n=r(9110),o=r(9147);let i=o.mF&&o.Nn?(0,n.eI)(o.mF,o.Nn,{auth:{autoRefreshToken:!1,persistSession:!1}}):null;function a(){if(!i)throw Error("Supabase client not configured. Check SUPABASE_URL and SUPABASE_SERVICE_KEY.");return i}async function s(e=o.Q0){let t=a(),{data:r,error:n}=await t.from("conferences").select("*").eq("slug",e).maybeSingle();if(n)throw Error(`Failed to load conference: ${n.message}`);return r}async function c(e){let t=a(),{data:r,error:n}=await t.from("conferences").select("*").eq("id",e).maybeSingle();if(n)throw Error(`Failed to load conference: ${n.message}`);return r}async function l(e){let t=a(),{count:r,error:n}=await t.from("registrations").select("*",{head:!0,count:"exact"}).eq("conference_id",e);if(n)throw Error(`Failed to count registrations: ${n.message}`);return r??0}async function u(e){let t=a(),{data:r,error:n}=await t.from("registrations").insert({conference_id:e.conferenceId,full_name:e.fullName,email:e.email,phone:e.phone??null,institution:e.institution??null,category:e.category,fee_amount:e.feeAmount,currency:e.currency}).select("*").maybeSingle();if(n||!r)throw Error(`Failed to create registration: ${n?.message??"unknown error"}`);return r}async function d(e,t){let r=a(),{error:n}=await r.from("registrations").update({qr_token:t}).eq("id",e);if(n)throw Error(`Failed to save QR token: ${n.message}`)}async function f(e){let t=a().from("registrations").select("*").eq("conference_id",e.conferenceId).order("created_at",{ascending:!1});if(e.search){let r=e.search;t=t.or(`full_name.ilike.%${r}%,email.ilike.%${r}%`)}e.limit&&(t=t.limit(e.limit));let{data:r,error:n}=await t;if(n)throw Error(`Failed to list registrations: ${n.message}`);return r??[]}async function m(e){let t=a(),{data:r,error:n}=await t.from("registrations").select("*").eq("id",e).maybeSingle();if(n)throw Error(`Failed to load registration: ${n.message}`);return r}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[809,667],()=>r(6925));module.exports=n})();