"use strict";(()=>{var e={};e.id=255,e.ids=[255],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},852:e=>{e.exports=require("async_hooks")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},2254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},4492:e=>{e.exports=require("node:stream")},7261:e=>{e.exports=require("node:util")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},9405:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>E,patchFetch:()=>y,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>b});var n={};t.r(n),t.d(n,{POST:()=>m});var i=t(2556),a=t(6546),o=t(4042),s=t(3675),c=t(2605),u=t(4137),l=t(2060),d=t(5564),p=t(9147),f=t(8331);async function m(e){let r=e.headers.get("x-admin-secret");try{(0,c.E)(r)}catch{return s.NextResponse.json({error:"Unauthorized"},{status:401})}let t=await e.json(),n=t?.registrationId;if(!n)return s.NextResponse.json({error:"registrationId is required"},{status:400});let i=await (0,u.Xd)(n);if(!i)return s.NextResponse.json({error:"Registration not found"},{status:404});let a=await (0,u.pb)(i.conference_id);if(!a)return s.NextResponse.json({error:"Conference not found"},{status:404});let o=i.qr_token;if(!o){let e={sub:i.id,name:i.full_name,cat:i.category,conf:a.slug,fee:i.fee_amount,cur:i.currency,iat:Math.floor(new Date(i.created_at).getTime()/1e3)};o=(await (0,f.Mj)(e,p.zV)).token,await (0,u.JQ)(i.id,o)}let m=await (0,l.s)(o);return await (0,d.X)({to:i.email,fullName:i.full_name,qrDataUrl:m,conferenceName:a.name,category:i.category,fee:i.fee_amount,currency:i.currency}),s.NextResponse.json({success:!0})}let g=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/resend/route",pathname:"/api/admin/resend",filename:"route",bundlePath:"app/api/admin/resend/route"},resolvedPagePath:"/Users/arbenlila/development/shfmk-association/apps/web/app/api/admin/resend/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:b,serverHooks:h}=g,E="/api/admin/resend/route";function y(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:b})}},2605:(e,r,t)=>{t.d(r,{E:()=>i});var n=t(9147);function i(e){if(!n.wb)throw Error("ADMIN_SECRET is not configured.");if(!e||e!==n.wb)throw Error("Unauthorized")}},5564:(e,r,t)=>{t.d(r,{X:()=>o});var n=t(9569),i=t(9147);let a=i.yL?new n.R(i.yL):null;async function o(e){if(!a)throw Error("Resend client missing. Set RESEND_API_KEY.");if(!i.ZE)throw Error("Missing RESEND_FROM_EMAIL.");let r=`Regjistrimi juaj p\xebr konferenc\xebn e SHFK`,t=`
    <div style="font-family: Arial, sans-serif; color: #111;">
      <p>P\xebrsh\xebndetje ${e.fullName},</p>
      <p>Faleminderit p\xebr regjistrimin tuaj n\xeb konferenc\xebn <strong>"${e.conferenceName}"</strong>.</p>
      <p>Kategoria juaj e regjistrimit \xebsht\xeb: <strong>${e.category}</strong>. Kostoja e pjes\xebmarrjes \xebsht\xeb <strong>${e.fee} ${e.currency}</strong>.</p>
      <p>M\xeb posht\xeb gjeni kodin tuaj QR. Ju lutemi ruajeni k\xebt\xeb kod (p.sh. si screenshot), pasi q\xeb do t\xeb p\xebrdoret p\xebr identifikimin tuaj n\xeb hyrje t\xeb konferenc\xebs. Skanimi i kodit b\xebhet pa pasur nevoj\xeb p\xebr internet.</p>
      <p style="text-align:center;">
        <img src="${e.qrDataUrl}" alt="Kodi QR" style="width:220px;height:220px;border:1px solid #eee;padding:8px;border-radius:12px;" />
      </p>
      <p>N\xebse kodi QR nuk shfaqet, ju lutemi vizitoni <a href="${i.Bt}/conference/register/success?token=${e.qrDataUrl}">faqen e suksesit t\xeb regjistrimit</a>.</p>
      <p>Me respekt,<br />Shoqata Farmaceutike e Kosov\xebs</p>
    </div>
  `;await a.emails.send({from:i.ZE,to:e.to,subject:r,html:t})}},9147:(e,r,t)=>{t.d(r,{Bt:()=>l,Nn:()=>a,Q0:()=>n,ZE:()=>s,mF:()=>i,wb:()=>u,yL:()=>o,zV:()=>c});let n=process.env.CONFERENCE_SLUG??"annual-conference",i=process.env.SUPABASE_URL??"",a=process.env.SUPABASE_SERVICE_KEY??"",o=process.env.RESEND_API_KEY??"",s=process.env.RESEND_FROM_EMAIL??"",c=process.env.QR_PRIVATE_KEY_PEM,u=process.env.ADMIN_SECRET??"",l=process.env.SITE_BASE_URL??"http://localhost:3000"},2060:(e,r,t)=>{t.d(r,{s:()=>i});var n=t(5951);async function i(e){return n.toDataURL(e,{errorCorrectionLevel:"M",margin:2})}},4137:(e,r,t)=>{t.d(r,{JQ:()=>d,LA:()=>p,Xd:()=>f,_Y:()=>l,nb:()=>u,o3:()=>s,pb:()=>c});var n=t(9110),i=t(9147);let a=i.mF&&i.Nn?(0,n.eI)(i.mF,i.Nn,{auth:{autoRefreshToken:!1,persistSession:!1}}):null;function o(){if(!a)throw Error("Supabase client not configured. Check SUPABASE_URL and SUPABASE_SERVICE_KEY.");return a}async function s(e=i.Q0){let r=o(),{data:t,error:n}=await r.from("conferences").select("*").eq("slug",e).maybeSingle();if(n)throw Error(`Failed to load conference: ${n.message}`);return t}async function c(e){let r=o(),{data:t,error:n}=await r.from("conferences").select("*").eq("id",e).maybeSingle();if(n)throw Error(`Failed to load conference: ${n.message}`);return t}async function u(e){let r=o(),{count:t,error:n}=await r.from("registrations").select("*",{head:!0,count:"exact"}).eq("conference_id",e);if(n)throw Error(`Failed to count registrations: ${n.message}`);return t??0}async function l(e){let r=o(),{data:t,error:n}=await r.from("registrations").insert({conference_id:e.conferenceId,full_name:e.fullName,email:e.email,phone:e.phone??null,institution:e.institution??null,category:e.category,fee_amount:e.feeAmount,currency:e.currency}).select("*").maybeSingle();if(n||!t)throw Error(`Failed to create registration: ${n?.message??"unknown error"}`);return t}async function d(e,r){let t=o(),{error:n}=await t.from("registrations").update({qr_token:r}).eq("id",e);if(n)throw Error(`Failed to save QR token: ${n.message}`)}async function p(e){let r=o().from("registrations").select("*").eq("conference_id",e.conferenceId).order("created_at",{ascending:!1});if(e.search){let t=e.search;r=r.or(`full_name.ilike.%${t}%,email.ilike.%${t}%`)}e.limit&&(r=r.limit(e.limit));let{data:t,error:n}=await r;if(n)throw Error(`Failed to list registrations: ${n.message}`);return t??[]}async function f(e){let r=o(),{data:t,error:n}=await r.from("registrations").select("*").eq("id",e).maybeSingle();if(n)throw Error(`Failed to load registration: ${n.message}`);return t}},8331:(e,r,t)=>{t.d(r,{Mj:()=>s});var n=t(5836),i=t(3438),a=t(3070),o=t(2606);async function s(e,r){let{key:t,generated:i,publicKeyPem:a}=await c(r),o=e.iat??Math.floor(Date.now()/1e3);return{token:await new n.N({name:e.name,cat:e.cat,conf:e.conf,fee:e.fee,cur:e.cur}).setProtectedHeader({alg:"RS256"}).setSubject(e.sub).setIssuedAt(o).sign(t),generated:i,publicKeyPem:a}}async function c(e){if(e)return{key:await (0,i.R7)(e,"RS256"),generated:!1};let r=await u();return{key:r.privateKey,generated:!0,privateKeyPem:r.privateKeyPem,publicKeyPem:r.publicKeyPem}}async function u(){let{privateKey:e,publicKey:r}=await (0,a.A)("RS256"),t=await (0,o.MF)(e),n=await (0,o.Rd)(r);return{privateKey:e,publicKey:r,privateKeyPem:t,publicKeyPem:n}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[809,667,256],()=>t(9405));module.exports=n})();